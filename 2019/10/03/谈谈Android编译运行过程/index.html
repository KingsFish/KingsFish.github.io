<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    
    <title>谈谈Android编译运行过程 | 葫芦籽的碎碎念</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="虚拟机,编译">
    <meta name="description" content="最近阅读了一下Android编译和运行相关的文章，大概了解了整体运行过程，在这里总结一下。">
<meta property="og:type" content="article">
<meta property="og:title" content="谈谈Android编译运行过程">
<meta property="og:url" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/index.html">
<meta property="og:site_name" content="葫芦籽的碎碎念">
<meta property="og:description" content="最近阅读了一下Android编译和运行相关的文章，大概了解了整体运行过程，在这里总结一下。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/ar.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/jvm.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/jvmAr.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/hotcode.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/back.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/jvmbytecode.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/dexbytecode.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/stackbase.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/gradleBuild.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/desuger.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/jack.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/d8.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/d8times.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/dexvsr8.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/provsr8.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/strcode.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/strbefore.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/strafter.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/running.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/oat.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/oatRun.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/share.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/numbers.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/time.png">
<meta property="og:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/har.png">
<meta property="article:published_time" content="2019-10-02T16:01:36.000Z">
<meta property="article:modified_time" content="2019-10-03T16:21:00.634Z">
<meta property="article:author" content="Fish">
<meta property="article:tag" content="虚拟机">
<meta property="article:tag" content="编译">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/ar.png">
    
        <link rel="alternate" type="application/atom+xml" title="葫芦籽的碎碎念" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 6.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/about" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/logo.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Fish</h5>
          <a href="mailto:kingsfish95@gmail.com" title="kingsfish95@gmail.com" class="mail">kingsfish95@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/KingsFish" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user-o"></i>
                关于
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/atom.xml"  >
                <i class="icon icon-lg icon-rss"></i>
                RSS订阅
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">谈谈Android编译运行过程</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">谈谈Android编译运行过程</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-10-02T16:01:36.000Z" itemprop="datePublished" class="page-time">
  2019-10-03
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%80%E3%80%81CPU-amp-JVM"><span class="post-toc-number">1.</span> <span class="post-toc-text">一、CPU &amp; JVM</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-1-JVM%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1.1 JVM内部结构</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-2-Interpreter-amp-JIT"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">1.2 Interpreter &amp; JIT</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-3-Dalvik"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">1.3 Dalvik</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BA%8C%E3%80%81Android-%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="post-toc-number">2.</span> <span class="post-toc-text">二、Android 构建过程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-1-Jack-amp-Jill"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">2.1 Jack &amp; Jill</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-2-D8"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.2 D8</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-R8"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">2.3 R8</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%89%E3%80%81Android%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="post-toc-number">3.</span> <span class="post-toc-text">三、Android运行过程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-1-Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">3.1 Dalvik虚拟机</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-2-ART"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">3.2 ART</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-3-PGO"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">3.3 PGO</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-4-%E9%B8%BF%E8%92%99%E7%B3%BB%E7%BB%9F-amp-%E6%96%B9%E8%88%9F%E7%BC%96%E8%AF%91%E5%99%A8"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">3.4 鸿蒙系统 &amp; 方舟编译器</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"><span class="post-toc-number">4.</span> <span class="post-toc-text">参考文档</span></a></li></ol>
        </nav>
    </aside>


<article id="post-谈谈Android编译运行过程"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">谈谈Android编译运行过程</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-10-03 00:01:36" datetime="2019-10-02T16:01:36.000Z"  itemprop="datePublished">2019-10-03</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>最近阅读了一下<code>Android</code>编译和运行相关的文章，大概了解了整体运行过程，在这里总结一下。</p>
<span id="more"></span>

<p>整篇文章相对而言不涉及到过多的技术细节，没有什么基础的人也能够通过这篇文章了解到<code>Android</code>的相关知识。</p>
<p>这篇文章内容较多，主要内容有：</p>
<ul>
<li><code>JVM</code>和<code>Android</code>的关系</li>
<li>字节码</li>
<li><code>Android</code>构建系统</li>
<li><code>AOT</code>和<code>JIT</code>的含义，以及它们和<code>R8</code>的关系</li>
<li><code>Android</code>运行系统</li>
</ul>
<p>在此之前，先要说一下一些基础知识。</p>
<h2 id="一、CPU-amp-JVM"><a href="#一、CPU-amp-JVM" class="headerlink" title="一、CPU &amp; JVM"></a>一、CPU &amp; JVM</h2><p>每台手机设备都具有<code>CPU</code>，<code>CPU</code>性能强弱是手机流畅性影响因素之一，这里不展开讨论这个问题。目前手机端有名的<code>CPU</code>应当是高通的骁龙系列。当然也有其他架构的<code>CPU</code>，如<code>ARM</code>、<code>ARM64</code>、<code>x86</code>、<code>x86_64</code>、<code>MIPS</code>。针对不同架构的<code>CPU</code>进行开发时，需要对不同的<code>CPU</code>架构生成不同的<code>.so</code>文件，这是一件很麻烦的事情。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="ar.png" alt="不同的CPU架构" title="">
                </div>
                <div class="image-caption">不同的CPU架构</div>
            </figure>

<p>这个时候<code>JVM</code>（Java虚拟机）就展示出了它的优势。<code>JVM（Java Virtual Machine）</code>会在硬件层面上增加一层抽象层。也就是说，你开发的<code>app</code>只需要支持<code>Java API</code>构成的”CPU”即可，再也不用被繁多的<code>CPU</code>架构困扰，也不用做额外的适配工作。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="jvm.png" alt="JVM原理" title="">
                </div>
                <div class="image-caption">JVM原理</div>
            </figure>

<p><code>Java</code>代码只需要使用<code>javac</code>编译器编译成字节码文件(<code>.class</code>文件)，然后代码就可以跑在<code>JVM</code>上，和操作系统隔离。一次编译，到处运行。这样，开发者无需考虑系统类型、设备类型、内存以及<code>CPU</code>，只要把精力集中在业务逻辑就可以了。</p>
<h3 id="1-1-JVM内部结构"><a href="#1-1-JVM内部结构" class="headerlink" title="1.1 JVM内部结构"></a>1.1 JVM内部结构</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="jvmAr.png" alt="JVM结构" title="">
                </div>
                <div class="image-caption">JVM结构</div>
            </figure>

<p>下面来说说<code>JVM</code>，<code>JVM</code>主要由三部分构成：</p>
<ul>
<li><code>ClassLoader</code><br>负责加载编译后的<code>Java</code>文件(<code>.class</code>)，验证链接关系，检测字节码是否正确，为静态变量和代码分配内存以及初始化。</li>
<li>运行时数据<br>负责所有的程序数据：<code>stack</code>、方法、变量还有<code>Heap</code></li>
<li>执行引擎<br>执行编译完成并加载的代码和<code>GC</code></li>
</ul>
<p>了解完以上知识之后，就可以开始继续了解解释器(<code>Interpreter</code>)和<code>JIT</code>编译器了。</p>
<h3 id="1-2-Interpreter-amp-JIT"><a href="#1-2-Interpreter-amp-JIT" class="headerlink" title="1.2 Interpreter &amp; JIT"></a>1.2 Interpreter &amp; JIT</h3><p>这两兄弟是一起工作的。每次跑程序时，<code>Interpreter</code>选取应当执行的<code>.class</code>字节码，然后将其实时翻译成机器码执行。这么做有一个缺点，如果一个方法或者逻辑被多次调用，那么每次调用都要重新翻译一次，效率特别低，实际上翻译出来的机器码可以重复使用。</p>
<p>在这种情况下，<code>JIT（Just In Time）</code>就派上用场了。执行引擎在<code>Interpreter</code>的帮助下将字节码翻译成机器码，如果发现有重复执行的代码，<code>JIT</code>就开始工作，将这部分频繁调用的代码翻译成机器码，当程序再次调用这个部分的逻辑时，执行引擎会直接使用<code>JIT</code>翻译完成的机器码，这样就能够提升系统的性能表现，这部分代码也叫<code>Hot Code</code>。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="hotcode.png" alt="执行流程" title="">
                </div>
                <div class="image-caption">执行流程</div>
            </figure>

<h3 id="1-3-Dalvik"><a href="#1-3-Dalvik" class="headerlink" title="1.3 Dalvik"></a>1.3 Dalvik</h3><p>那么上面说的这些和<code>Android</code>有什么关系呢？</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="back.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p><code>JVM</code>设计运行的硬件环境和<code>Android</code>设备不一样，<code>JVM</code>最初是为电视机顶盒设计的，拥有“无限”电量，而一般来说手机设备有<code>4000mah</code>已经是很大的电池了，另外<code>Android</code>设备存储空间比较小（现在其实挺大的）。因此，<code>Google</code>修改了<code>JVM</code>的整体结构，包括<code>Java</code>代码编译过程和字节码结构，以适应手机设备。编译过程的差异将在下一节讲述，字节码结构则下面用代码实例说明一下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">method</span><span class="params">(<span class="type">int</span> i1, <span class="type">int</span> i2)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i3</span> <span class="operator">=</span> i1 + i2;</span><br><span class="line">    <span class="keyword">return</span> i3 * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面这段代码生成的<code>.class</code>字节码如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="jvmbytecode.png" alt="java bytecode" title="">
                </div>
                <div class="image-caption">java bytecode</div>
            </figure>

<p>使用<code>Android</code>的<code>Dex</code>编译器编译代码生成的<code>.dex</code>字节码如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="dexbytecode.png" alt="Dex bytecode" title="">
                </div>
                <div class="image-caption">Dex bytecode</div>
            </figure>

<p>两张图对比可以明显看出来，<code>.dex</code>字节码会比<code>.class</code>字节码更简洁。</p>
<p>另外，<code>Java</code>字节码是基于栈结构（所有的变量都存储在栈上）的，而<code>Dex</code>字节码基于寄存器结构（所有变量存储在寄存器中）。</p>
<p>基于栈结构的字节码，在执行操作时需要先将操作数加载到操作栈上，然后计算，最后再将得到的结果从栈上弹出到局部变量表中。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="stackbase.png" alt="基于栈的计算过程" title="">
                </div>
                <div class="image-caption">基于栈的计算过程</div>
            </figure>

<p>而基于寄存器的字节码可以直接读取寄存器中存储的数据，然后一步到位将结果存入另外的寄存器。<code>Dex</code>这种字节码相对<code>Java</code>字节码而言更高效，需要的空间也更少。</p>
<p>在<code>Android 5.0</code>以前，Android系统中解析<code>Dex</code>字节码的虚拟机叫做<code>Dalvik</code>。</p>
<p><code>Dalvik</code>加载和解析执行<code>Dex</code>字节码的方式和<code>JVM</code>使用<code>JIT</code>以及<code>Interpreter</code>一样。</p>
<h2 id="二、Android-构建过程"><a href="#二、Android-构建过程" class="headerlink" title="二、Android 构建过程"></a>二、Android 构建过程</h2><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="gradleBuild.png" alt="Gralde Build Process" title="">
                </div>
                <div class="image-caption">Gralde Build Process</div>
            </figure>

<p><code>.java</code>和<code>.kt</code>文件由<code>Java/Kotlin</code>编译器编译成<code>.class</code>文件。这些<code>.class</code>文件则通过<code>Dex</code>编译器编译成<code>.dex</code>文件，最终和资源文件等打包成<code>.apk</code>文件。</p>
<p>可以看到，<code>Android</code>构建其实和<code>Java</code>语言有很大关系。<code>Java</code>语言基本每年更新一个新版本，目前最新的是<code>Java 12</code>。而相对于<code>Java</code>的迅速迭代而言，<code>Android</code>虚拟机则慢了很多，很多语言新特性无法直接在虚拟机上使用。因此，<code>Android</code>构建过程中，除了要将<code>class</code>文件转化成<code>dex</code>文件之外，还有一个重要的任务是将新特性转化成老版本<code>Java</code>能够运行的特性，也就是所谓的“脱糖”。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="desuger.png" alt="脱糖" title="">
                </div>
                <div class="image-caption">脱糖</div>
            </figure>

<h3 id="2-1-Jack-amp-Jill"><a href="#2-1-Jack-amp-Jill" class="headerlink" title="2.1 Jack &amp; Jill"></a>2.1 Jack &amp; Jill</h3><p>为了解决这个问题，<code>Google</code>在16年推出了<code>Jack &amp; Jill</code>这套编译机制。具体流程如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="jack.png" alt="Jack & Jill" title="">
                </div>
                <div class="image-caption">Jack & Jill</div>
            </figure>

<p><code>Google</code>想使用<code>Jack</code>工具直接将<code>Java</code>代码编译成<code>dex</code>文件，至于应用所使用过的第三方库，则使用<code>Jill</code>工具编译成中间文件然后再编译成<code>dex</code>文件。</p>
<p>这样看起来简单明了，没有那么多中间过程。但实际效果没有预期那么好。<code>Google</code>需要重新实现Java生态所有特性支持，如注解，工作量很大；并且有些第三方库依赖于Java字节码神效；另外，经过实际应用，发现这个工具速度慢，耗内存，且不支持<code>instant run</code>。<code>Google</code>在17年废弃了这个编译工具链。</p>
<h3 id="2-2-D8"><a href="#2-2-D8" class="headerlink" title="2.2 D8"></a>2.2 D8</h3><p>为了改善构建环境，<code>Google</code>在<code>Android Studio 3.2</code>中使用<code>D8(Dope 8)</code>取代了原来的<code>Dex</code>编译器。这个替换操作主要的目的是将脱糖操作和<code>class2dex</code>操作合并，减少构建时间。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="d8.png" alt="D8构建过程" title="">
                </div>
                <div class="image-caption">D8构建过程</div>
            </figure>

<p>那么<code>D8</code>有多快呢？这得分工程规模来看。小<code>APP</code>的话，<code>100</code>次构建取平均值之后，优化的时间为<code>2s</code>。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="d8times.png" alt="D8构建时间对比图" title="">
                </div>
                <div class="image-caption">D8构建时间对比图</div>
            </figure>

<p>官方描述<code>D8</code>的优点有：</p>
<ul>
<li>编译更快、时间更短；</li>
<li>DEX 编译时占用内容更小；</li>
<li>.dex 文件大小更小；</li>
<li>D8 编译的 .dex 文件拥有相同或者是更好的运行时性能；</li>
</ul>
<p>这还没完，<code>Google</code>还有一个大招。</p>
<h3 id="2-3-R8"><a href="#2-3-R8" class="headerlink" title="2.3 R8"></a>2.3 R8</h3><p><code>R8</code>是<code>D8</code>的衍生产品，他们使用相同的代码库，但是<code>R8</code>还解决了其他问题。跟<code>D8</code>一样，<code>R8</code>也能将<code>Java</code>新<code>feature</code>提供给开发者使用，但不仅限于此。</p>
<p><code>R8</code>带来的一个最大改进是优化<code>.dex</code>中的代码，只保留了支持应用所需要的<code>API</code>，删除了没有用上的类和方法。</p>
<p>另外，<code>R8</code>能够替代<code>Proguard</code>。<code>Proguard</code>是一个在构建过程中使用到的混淆工具，在<code>.class</code>转换<code>.dex</code>过程中，<code>R8</code>会替代<code>Proguard</code>的工作，比如优化、混淆代码，移除无用的类。</p>
<p>用Java 8的lambda表达式做测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MathLambda</span> &#123;</span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">NumericTest</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="title function_">computeTest</span><span class="params">(<span class="type">int</span> n)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">(NumericTest numericTest)</span> &#123;</span><br><span class="line">        numericTest.computeTest(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">java8ShowCase</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MathLambda</span> <span class="variable">math</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MathLambda</span>();</span><br><span class="line">        math.doSomething((n) -&gt; (n % <span class="number">2</span>) == <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>R8</code>能够减少生成的字节码行数。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="dexvsr8.png" alt="Dex vs R8" title="">
                </div>
                <div class="image-caption">Dex vs R8</div>
            </figure>

<p><code>R8</code>在<code>Android Studio 3.4</code>被引入并默认开启，官方宣称能够优化逻辑代码，混淆代码和清除无用的类和方法。</p>
<p>同一个APP，分别使用Dex+Proguard和R8构建100次，取平均值，结果如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="provsr8.png" alt="Dex-Proguard vs R8" title="">
                </div>
                <div class="image-caption">Dex-Proguard vs R8</div>
            </figure>

<p>如上图，在构建过程中，使用<code>R8</code>减少了<code>13s</code>构建时间，同时减少了<code>112</code>个方法，生成的<code>apk</code>也小了<code>348kb</code>。整体而言，结果很不错。</p>
<p>举一个<code>R8</code>优化字符串操作的例子，如下代码：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="strcode.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>直接编译成字节码如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="strbefore.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>从字节码可以看到，每次都先计算字符串<code>WILDCARD</code>的长度，然后取子字符串。其实字符串常量<code>WILDCARD</code>长度为固定的，所以没有必要一次次重新计算，编译期计算出来就可以。优化之后的字节码如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="strafter.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>可以看到<code>0008</code>行直接将一个固定值赋给了变量<code>v0</code>，然后在获取子字符串进行之后的操作。</p>
<h2 id="三、Android运行过程"><a href="#三、Android运行过程" class="headerlink" title="三、Android运行过程"></a>三、Android运行过程</h2><h3 id="3-1-Dalvik虚拟机"><a href="#3-1-Dalvik虚拟机" class="headerlink" title="3.1 Dalvik虚拟机"></a>3.1 Dalvik虚拟机</h3><p>从应用商店下载一个<code>apk</code>文件，安装后，点击图标<code>icon</code>，然后就可以看到<code>APP</code>运行在了手机上。那么中间发生了哪些事情？</p>
<p><code>APK</code>安装文件一般包含了所有的资源文件（图片，图标和布局等）和代码文件，安装时系统会把这些资源存储到内存中。当用户点击应用图标时，手机会启动一个<code>Dalvik</code>进程，然后将该<code>app</code>的<code>dex</code>文件加载到内存，同时<code>Dalvik</code>虚拟机将会把<code>dex</code>字节码通过<code>Interpreter</code>或<code>JIT</code>翻译成机器码，最终这款<code>app</code>运行在了你手机上。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="running.png" alt="APP 运行过程" title="">
                </div>
                <div class="image-caption">APP 运行过程</div>
            </figure>

<p>当应用要使用到某部分代码（字节码）时，<code>Dalvik</code>会通过<code>Interpreter</code>将字节码实时翻译成机器码运行，经过一段时间后，如果有部分代码被经常调用（比如刷抖音时调用的请求视频数据逻辑），那么这部分代码会被定义成<code>hotcode</code>，随后被<code>JIT</code>翻译成机器码存储在内存中。当这部分代码再次被调用时，就不需要实时翻译，直接使用翻译好的机器码即可，这样就提高了运行效率。</p>
<p>这个过程和餐厅接待客人的一些现象很相似。<code>Interpreter</code>就是客人来了之后现场点现场做，<code>JIT</code>则是根据之前的经验，将这个客人常点的菜提前先做好，这样就能提高上菜速度。</p>
<p><code>JIT</code>机制是<code>Android 2.2</code>引入的，之前全靠<code>Interpreter</code>实时翻译，可想而知之前卡顿有多严重。</p>
<h3 id="3-2-ART"><a href="#3-2-ART" class="headerlink" title="3.2 ART"></a>3.2 ART</h3><p><code>Dalvik</code>对于手机设备来说是一个很好的解决方案，但是它。因此<code>Google</code>对<code>JVM</code>进行了改进，推出了一种新的<code>JVM</code>，称为<code>ART</code>虚拟机。<code>Dalvik</code>和<code>ART</code>最大的区别在于<code>ART</code>不会在运行时对字节码进行翻译执行，而是把这个过程提前到了安装过程中。<code>ART</code>使用<code>AOT（Ahead of Time）</code>编译器来将字节码翻译成<code>.oat</code>文件。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="oat.png" alt="AOT 运行过程" title="">
                </div>
                <div class="image-caption">AOT 运行过程</div>
            </figure>

<p><code>APP</code>被安装时，<code>ART</code>将<code>Dex</code>字节码预编译成<code>.oat</code>文件，每次启动<code>APP</code>时系统直接读取<code>.oat</code>文件运行即可，不再使用<code>JIT</code>以及<code>Interpreter</code>这种即时翻译的工具，大大提升了运行流畅度。</p>
<p>这样看起来好像<code>AOT</code>好像没什么毛病，<code>Google</code>当初也觉得自己找到了终极解决方式，但实际上<code>AOT</code>还是会有一些问题：</p>
<ul>
<li><code>AOT</code>在安装过程中进行预编译行为，这样安装和更新<code>APP</code>时间相比原来就会大大增加。另外，升级<code>Android</code>系统时，系统会把所有程序重新安装一次，想想那么多<code>APP</code>要重新安装编译成<code>.oat</code>文件，头都大了。</li>
<li>空间大小。<code>AOT</code>将整个<code>.dex</code>文件都翻译为<code>.oat</code>文件，包括那种很少使用或者根本不会被使用到的代码（比如第一次打开<code>APP</code>的设置向导或者开屏界面）。根据<code>Google</code>相关的数据，常用的代码大概占所有代码的<code>15~20%</code>左右，这样就浪费了很大一部分空间，在一些小存储容量的低端机上这个问题尤其明显。</li>
</ul>
<p>既然这也不好，那也不好，那就集中两种方式的优点就好了。<code>Google</code>工程师想出了一个新点子：<code>Interpreter + JIT + AOT</code>混合编译，具体方案如下：</p>
<ol>
<li>安装的时候不进行预编译，也即不生成<code>.oat</code>文件。<code>app</code>第一次启动时，<code>ART</code>使用<code>Interpreter</code>来实时翻译<code>.dex</code>文件。</li>
<li>当出现<code>Hot Code</code>时，使用<code>JIT</code>进行翻译，并将翻译后的机器码存入缓存（内存）中，之后调用<code>Hot Code</code>时直接从缓存中取。</li>
<li>当设备空闲时，比如锁屏，<code>Hot Code</code>会被<code>AOT</code>编译器编译成<code>oat</code>文件存入本地存储空间。</li>
<li><code>app</code>再次启动时，如果存在<code>.oat</code>文件，那么直接使用<code>.oat</code>文件，否则从步骤1开始。</li>
</ol>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="oatRun.png" alt="AOT 运行过程" title="">
                </div>
                <div class="image-caption">AOT 运行过程</div>
            </figure>

<p>国内的厂商会有“基于用户操作习惯进行学习，APP打开速度不断提高<br>”的说法，有一部分是这个混合编译方案的功劳。</p>
<p>根据官方数据，平均来看，app运行8次之后，这个机制能够优化80%的空间。</p>
<p>这个混合机制为<code>Android N(5.0)</code>引入的，也正是这个时候开始用户对<code>Android</code>的运行效率看法有了改观。</p>
<h3 id="3-3-PGO"><a href="#3-3-PGO" class="headerlink" title="3.3 PGO"></a>3.3 PGO</h3><p>经过上面这些动作，<code>Android</code>的运行速度其实已经有很大的改观。但还是有可以改进的地方。</p>
<p>在说<code>AOT</code>混合编译的时候系统会生成一个<code>profile</code>，这个<code>profile</code>记录了<code>hotcode</code>的信息，哪些类和哪些方法会被经常调用。而对于大多数人来说，同一个<code>APP</code>的<code>hotcode</code>区别不大，其实可以共用，因此<code>Google</code>在<code>2018 Google I/O</code>大会上提出了<code>Cloud Profiles</code>的方案。具体原理如下：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="share.png" alt="共享" title="">
                </div>
                <div class="image-caption">共享</div>
            </figure>

<p>这个方案依赖<code>Google Play</code>来完成。当一个设备为空闲状态并且连接到<code>WiFi</code>时，<code>Google Play Service</code>会将编译后的文件共享，之后如果有一样的手机从<code>Googole Play</code>中下载这个<code>APP</code>时，终端会收到其他人的<code>hotcode</code>信息，这样用户在第一次使用时就能获得良好的体验。</p>
<p>但实际上，一个人的<code>hotcode</code>无法代表所有人的<code>hotcode</code>信息，那么需要多少个样本才能拿到一个比较稳定的<code>hotcode profile</code>呢？根据官方的数据，这个数字还挺小的。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="numbers.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>平均而言，<code>30</code>个<code>profile</code>已经能达到一个比较稳定的水平，而且效果也不差。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="time.png" alt="启动时间" title="">
                </div>
                <div class="image-caption">启动时间</div>
            </figure>

<p>然而这些方案对于国内来说都没什么用…因为没法使用<code>Google Play</code>。但<code>Android 9</code>开始，<code>Google</code>提供了一个内置<code>hotcode</code>的方案，也就是说，可以在构建期间往<code>APP</code>中放置<code>hotcode</code>信息，这样系统在安装<code>APP</code>时直接将这部分代码编译成机器码，速度会有很大的提升。</p>
<p>不过这部分内容在国内资料很少，<code>Google</code>搜索了之后也才发现官方给了这一篇文章，<a target="_blank" rel="noopener" href="https://source.android.google.cn/devices/tech/perf/pgo#using-pgo">Build With PGO</a>，有兴趣的可以自己继续了解一下。</p>
<h3 id="3-4-鸿蒙系统-amp-方舟编译器"><a href="#3-4-鸿蒙系统-amp-方舟编译器" class="headerlink" title="3.4 鸿蒙系统 &amp; 方舟编译器"></a>3.4 鸿蒙系统 &amp; 方舟编译器</h3><p>说到了编译器和<code>Android</code>的运行机制，不得不说一下最近大热的华为鸿蒙系统和方舟编译器。这里先放一张官网给的架构图：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="har.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>在网上搜集了一些信息之后，不得不说华为的愿景很大。想把<code>Java/Kotlin、C++</code>直接编译成能够运行的机器码，据了解的信息，普通的<code>APP</code>经过华为的编译器之后，包体积会增大一些。另外，对于语言的动态特性，比如<code>Java</code>的多态，直接在编译期处理成静态特性。这些都是华为官方宣称的优点，不知道华为具体是怎么做的，拭目以待吧。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a target="_blank" rel="noopener" href="https://proandroiddev.com/android-cpu-compilers-d8-r8-a3aa2bfbc109">https://proandroiddev.com/android-cpu-compilers-d8-r8-a3aa2bfbc109</a></li>
<li><a target="_blank" rel="noopener" href="https://source.android.google.cn/devices/tech/perf/pgo#case-study-pgo-for-art">https://source.android.google.cn/devices/tech/perf/pgo#case-study-pgo-for-art</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5ca480b66fb9a05e1d26bb7a">https://juejin.im/post/5ca480b66fb9a05e1d26bb7a</a></li>
<li><a target="_blank" rel="noopener" href="https://www.infoq.com/news/2019/04/play-cloud-art-profiling-android/">https://www.infoq.com/news/2019/04/play-cloud-art-profiling-android/</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5d4bdb23e51d453c2577b747">https://juejin.im/post/5d4bdb23e51d453c2577b747</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/62794593">https://zhuanlan.zhihu.com/p/62794593</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5cbe60796fb9a0324d43ab97#heading-5">https://juejin.im/post/5cbe60796fb9a0324d43ab97#heading-5</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Mr_dsw/article/details/90141647">https://blog.csdn.net/Mr_dsw/article/details/90141647</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/65307730">https://zhuanlan.zhihu.com/p/65307730</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-10-03T16:21:00.634Z" itemprop="dateUpdated">2019-10-04 00:21:00</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://KingsFish.github.io">
            <img src="/img/logo.jpg" alt="Fish">
            Fish
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BC%96%E8%AF%91/" rel="tag">编译</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" rel="tag">虚拟机</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/&title=《谈谈Android编译运行过程》 — 葫芦籽的碎碎念&pic=https://KingsFish.github.io/img/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/&title=《谈谈Android编译运行过程》 — 葫芦籽的碎碎念&source=最近阅读了一下Android编译和运行相关的文章，大概了解了整体运行过程，在这里总结一下。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《谈谈Android编译运行过程》 — 葫芦籽的碎碎念&url=https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/&via=https://KingsFish.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/01/04/2019-%E5%B9%B2%E4%BA%86%E4%BA%9B%E4%BB%80%E4%B9%88/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">2019 我干了些什么</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2019/09/21/%E8%91%AB%E8%8A%A6%E7%B1%BD%E7%9A%84%E7%A2%8E%E7%A2%8E%E5%BF%B5/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">我的微信公众号开通了~</h4>
      </a>
    </div>
  
</nav>



    




















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        打赏点饭钱~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Fish &copy; 2017 - 2024</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/&title=《谈谈Android编译运行过程》 — 葫芦籽的碎碎念&pic=https://KingsFish.github.io/img/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/&title=《谈谈Android编译运行过程》 — 葫芦籽的碎碎念&source=最近阅读了一下Android编译和运行相关的文章，大概了解了整体运行过程，在这里总结一下。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《谈谈Android编译运行过程》 — 葫芦籽的碎碎念&url=https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/&via=https://KingsFish.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://kingsfish.github.io/2019/10/03/%E8%B0%88%E8%B0%88Android%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAAD8klEQVR42u3awW4bMQwE0Pz/T6dA0UOBJMoMqXUD9O3JiB2v9PYwJsW3t/h6/319fP3xM39fH//+1SeT66v1nO/y9sSFAwcOHDiCrZ4Xcb59vojz58+I7QPLHwAOHDhw4HiCI7/BLMA2EEnoJt9w3iMOHDhw4Hg9xzl0k3fbsrANzlnZiQMHDhw4/hXHc4GXNP7yleDAgQMHjp/AkTQHN0VX3l5s23/t+q/1SnHgwIEDx7yzF5VzP/n1i+Y7cODAgeO/55gNq83G2tqRiCQIbw3h/fkGHDhw4MCx5pgdFLXBNivV8ubj/t2iN4kDBw4cOI6rnW2mvfFmeC4ZlWgD+5suKQ4cOHDgWHC0QbsZFzjH56bNNyPDgQMHDhxPcGy2nbf8ZhtrWduG4yerwoEDBw4cj3G0i57FZxKNs/hsy9HiaeDAgQMHjrhyuXWD2QFSiztrUEZ3xIEDBw4cC4523O0chC3N7LBqxhr9FMCBAwcOHI9xtI22hKkdj9jfN4fGgQMHDhy3ONqrjeFZgVe384LybBbkOHDgwIFjxnF3ZCFf3KaRV5dneaziwIEDB44Fxz6Hc7L8HOy5RuQ39Dhw4MCBY82RF07tBtoS6xyK+4KwDWMcOHDgwDHjyIOwhchDbjamMIzM8wPAgQMHDhwPc+QDBPlxUVtW5aVgXkYWzwEHDhw4cIxGGfIxhbZYSrjbQu5CoJ53gQMHDhw4HubYx2pbjOURezfIceDAgQPHXY7ZKMOsoMprqE2jsL0LDhw4cOC4xdG22JJy7om/7I+j6kYnDhw4cOAoOdqyLWn85UMGd0vE2fPHgQMHDhx3OWaHRrNRg+SYKllJyzErI3HgwIEDxyZHZtG4KcxmTcANX7IeHDhw4MBxi6MdSkhet0ufNfjqDZ/XgAMHDhw4rnLkW002kyyiLc/yInPYvsSBAwcOHJdOgjZhmcfwrHTcHH21TUwcOHDgwLHnaA9v8nfbJuCtA6TVEAYOHDhw4FhzJK20Wy3CtiFYTGGM7vtN3OLAgQMHjhHHrTbcrcG7toxMHmH+QwEHDhw4cNziyL80H1BoP5m3+fIfAQ/+4sCBAwcOHMGx0z7e2vDehPRsnCL6Lxw4cODAseB4L688bm+1BfPIbEvET74TBw4cOHCsOWaHOrOiK4nJNmKTAu9WoxMHDhw4cOQcs3Bti6XZqETLVxwyJRUtDhw4cOBYcNwaR2jjcHY01dIkrDhw4MCB4/Uceejm7bxNYZY/gOJB4sCBAweOl3NsCrnZkMS+jMwH+HDgwIEDxy2OPJxmh1LtEMOsnNsUpThw4MCB4xbHLOTy/2oHFGYF2yyMhyg4cODAgePzb/gFiQGRA8fIwWIAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdnjs.cloudflare.com/ajax/libs/node-waves/0.7.6/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.js?v=1.7.2" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
